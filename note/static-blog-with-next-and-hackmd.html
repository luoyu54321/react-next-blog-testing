<!DOCTYPE html><html><head><meta charSet="utf-8"/><title>KK Blog - [å¯¦ä½œç´€éŒ„] ä½¿ç”¨ Github Action (CI/CD), Hackmd å»ºç«‹å³æ™‚æ›´æ–°çš„å€‹äºº blog </title><meta name="viewport" content="initial-scale=1.0, width=device-width"/><meta name="description" content="KK Blog - [å¯¦ä½œç´€éŒ„] ä½¿ç”¨ Github Action (CI/CD), Hackmd å»ºç«‹å³æ™‚æ›´æ–°çš„å€‹äºº blog"/><meta name="keywords" content="Next,Dynamic Route,Github Action,Hackmd,å¯¦ä½œç­†è¨˜"/><meta name="og:type" content="website"/><meta name="og:image" content="/kk-logo.svg"/><meta name="og:title" content="KK Blog | Note"/><meta name="og:description" content="KK Blog - [å¯¦ä½œç´€éŒ„] ä½¿ç”¨ Github Action (CI/CD), Hackmd å»ºç«‹å³æ™‚æ›´æ–°çš„å€‹äºº blog"/><link rel="canonical" href="https://blog.kkluo.com/note/static-blog-with-next-and-hackmd"/><link rel="shortcut icon" href="..//favicon.ico"/><link rel="icon" type="image/png" sizes="32x32" href="..//favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="..//favicon-96x96.png"/><link rel="icon" type="image/png" sizes="16x16" href=".//favicon-16x16.png"/><link rel="apple-touch-icon" href="..//favicon-96x96.png"/><link rel="shortcut icon" href="..//favicon-96x96.png"/><link rel="apple-touch-icon-precomposed" href="..//favicon-96x96.png"/><meta name="next-head-count" content="17"/><link rel="preload" href="/_next/static/css/9e8fdcc1ec92f2af57db.css" as="style"/><link rel="stylesheet" href="/_next/static/css/9e8fdcc1ec92f2af57db.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.4b1beca48388539e3889.js" as="script"/><link rel="preload" href="/_next/static/chunks/7751f052908bdf88c510ca6de06c69a2e694bfcc.f5a7ca967e991739ef1f.js" as="script"/><link rel="preload" href="/_next/static/chunks/main-b56ab24403fe3799fc3d.js" as="script"/><link rel="preload" href="/_next/static/chunks/e52c9149a6a64a5c94b81cf3acc4d0fb13eb3001.fa77069985ac71631d77.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-9a36d99722b7751d4fff.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/note/%5Bid%5D-d4f1f3ec65736fd998ff.js" as="script"/><style id="__jsx-2665686021">.st0.jsx-2665686021{fill:#EE7D18;}.st1.jsx-2665686021{fill:#3F3B3C;}</style></head><body><div id="__next"><div><div class="header__Navcolor-sc-167w593-2 hbzXgv"><div class="header__HeaderContainer-sc-167w593-8 ktEEKB"><div class="header__ImageLogoContainer-sc-167w593-0 jcgCzC"><svg width="150" height="50" xmlns="http://www.w3.org/2000/svg" id="Layer_1" data-name="Layer 1" viewBox="0 0 50 10" class="jsx-2665686021"><g class="jsx-2665686021"><path d="M3.9,10.3c-0.1,0-0.2,0-0.2-0.1c-0.1-0.1-0.1-0.1-0.1-0.2V2.2c0-0.1,0-0.1,0.1-0.2s0.1-0.1,0.2-0.1h1.4 c0.1,0,0.2,0,0.2,0.1s0.1,0.1,0.1,0.2v0.1c0,0.1,0,0.2-0.1,0.2C5.5,2.6,5.4,2.6,5.3,2.6H4.6c0,0,0,0,0,0v6.9c0,0,0,0,0,0h0.7 c0.1,0,0.2,0,0.2,0.1s0.1,0.1,0.1,0.2V10c0,0.1,0,0.2-0.1,0.2c-0.1,0.1-0.1,0.1-0.2,0.1H3.9z" class="jsx-2665686021 st0"></path><path d="M9.1,8.8c-0.1,0-0.2,0-0.2-0.1S8.8,8.6,8.8,8.5V2.8c0-0.1,0-0.2,0.1-0.2S9,2.5,9.1,2.5h0.7 c0.1,0,0.2,0,0.2,0.1S10,2.7,10,2.8v2.4c0,0,0,0,0,0s0,0,0,0L12,2.7c0.1-0.2,0.3-0.2,0.5-0.2h0.8c0.1,0,0.1,0,0.1,0.1 c0,0.1,0,0.1,0,0.2l-1.7,2.2c0,0,0,0,0,0.1l2.1,3.6c0,0,0,0.1,0,0.1s0,0.1,0,0.1c0,0.1-0.1,0.1-0.2,0.1h-0.8 c-0.2,0-0.3-0.1-0.4-0.3L10.9,6c0,0,0,0,0,0L10,7c0,0,0,0,0,0.1v1.4c0,0.1,0,0.2-0.1,0.2S9.8,8.8,9.7,8.8H9.1z" class="jsx-2665686021 st1"></path><path d="M15.2,8.9c-0.2,0-0.4-0.1-0.6-0.2s-0.2-0.4-0.2-0.6c0-0.2,0.1-0.4,0.2-0.6c0.1-0.2,0.3-0.2,0.6-0.2 c0.2,0,0.4,0.1,0.6,0.2C16,7.7,16,7.9,16,8.1c0,0.2-0.1,0.4-0.2,0.6S15.5,8.9,15.2,8.9z" class="jsx-2665686021 st1"></path><path d="M17.7,8.8c-0.1,0-0.2,0-0.2-0.1s-0.1-0.1-0.1-0.2V2.8c0-0.1,0-0.2,0.1-0.2s0.1-0.1,0.2-0.1h0.7 c0.1,0,0.2,0,0.2,0.1s0.1,0.1,0.1,0.2v5c0,0,0,0,0,0H21c0.1,0,0.2,0,0.2,0.1s0.1,0.1,0.1,0.2v0.5c0,0.1,0,0.2-0.1,0.2 S21,8.8,21,8.8H17.7z" class="jsx-2665686021 st1"></path><path d="M24.6,8.8c-0.1,0-0.2,0-0.2-0.1s-0.1-0.1-0.1-0.2V2.8c0-0.1,0-0.2,0.1-0.2s0.1-0.1,0.2-0.1h1.8 c1.5,0,2.3,0.5,2.3,1.6c0,0.3-0.1,0.6-0.2,0.8c-0.2,0.3-0.4,0.4-0.6,0.5c0,0,0,0,0,0c0,0,0,0,0,0c0.4,0.1,0.6,0.3,0.9,0.5 C28.9,6.2,29,6.6,29,7c0,0.6-0.2,1.1-0.7,1.4c-0.5,0.3-1,0.5-1.8,0.5H24.6z M25.6,5C25.6,5,25.6,5.1,25.6,5l0.7,0 c0.4,0,0.7-0.1,0.9-0.2c0.2-0.1,0.3-0.3,0.3-0.6c0-0.3-0.1-0.5-0.3-0.6c-0.2-0.1-0.5-0.2-0.9-0.2h-0.7c0,0,0,0,0,0V5z M25.6,7.8 C25.6,7.8,25.6,7.8,25.6,7.8l0.9,0c0.9,0,1.3-0.3,1.3-1c0-0.3-0.1-0.5-0.3-0.7c-0.2-0.1-0.6-0.2-1-0.2h-0.8c0,0,0,0,0,0V7.8z" class="jsx-2665686021 st1"></path><path d="M31.2,8.9c-0.4,0-0.7-0.1-0.9-0.4S30,8,30,7.5V2.3c0-0.1,0-0.1,0.1-0.2S30.3,2,30.3,2H31c0.1,0,0.2,0,0.2,0.1 c0.1,0.1,0.1,0.1,0.1,0.2v5.3c0,0.2,0.1,0.3,0.2,0.4c0,0,0,0,0.1,0s0.1,0,0.1,0.1c0,0,0,0,0.1,0.1c0,0,0.1,0,0.1,0.1 c0,0,0,0.1,0,0.1l0.1,0.4c0,0,0,0,0,0.1c0,0.1,0,0.1,0,0.2c0,0.1-0.1,0.1-0.2,0.1C31.5,8.9,31.4,8.9,31.2,8.9z" class="jsx-2665686021 st1"></path><path d="M35.6,8.8c-0.3,0.1-0.6,0.2-0.9,0.2s-0.6-0.1-0.9-0.2c-0.3-0.1-0.5-0.3-0.7-0.5c-0.2-0.2-0.4-0.5-0.5-0.8 c-0.1-0.3-0.2-0.7-0.2-1.1c0-0.4,0.1-0.7,0.2-1.1c0.1-0.3,0.3-0.6,0.5-0.8c0.2-0.2,0.5-0.4,0.7-0.5c0.3-0.1,0.6-0.2,0.9-0.2 s0.6,0.1,0.9,0.2c0.3,0.1,0.5,0.3,0.7,0.5c0.2,0.2,0.4,0.5,0.5,0.8C37,5.7,37.1,6,37.1,6.4c0,0.4-0.1,0.7-0.2,1.1 c-0.1,0.3-0.3,0.6-0.5,0.8C36.1,8.5,35.9,8.7,35.6,8.8z M34,7.5c0.2,0.3,0.4,0.4,0.8,0.4s0.6-0.1,0.8-0.4c0.2-0.3,0.3-0.6,0.3-1.1 s-0.1-0.8-0.3-1.1s-0.4-0.4-0.8-0.4S34.2,5.1,34,5.3S33.7,6,33.7,6.4S33.8,7.3,34,7.5z" class="jsx-2665686021 st1"></path><path d="M39.8,10.9c-0.6,0-1.1-0.1-1.5-0.3c-0.4-0.2-0.6-0.5-0.6-0.9c0-0.4,0.2-0.7,0.7-1c0,0,0,0,0,0c0,0,0,0,0,0 C38.2,8.5,38,8.2,38,7.9c0-0.2,0-0.3,0.1-0.5c0.1-0.2,0.2-0.3,0.4-0.4c0,0,0,0,0,0s0,0,0,0c-0.2-0.1-0.3-0.3-0.4-0.5 s-0.2-0.5-0.2-0.7c0-0.5,0.2-1,0.6-1.3s0.8-0.5,1.4-0.5c0.2,0,0.5,0,0.7,0.1c0,0,0,0,0.1,0H42c0.1,0,0.2,0,0.2,0.1 c0.1,0.1,0.1,0.1,0.1,0.2v0.3c0,0.1,0,0.1-0.1,0.2S42.1,5,42,5h-0.5c0,0,0,0,0,0c0.1,0.2,0.2,0.4,0.2,0.7c0,0.5-0.2,0.9-0.5,1.2 c-0.3,0.3-0.8,0.4-1.3,0.4c-0.2,0-0.4,0-0.6-0.1c0,0,0,0-0.1,0c-0.1,0.1-0.2,0.2-0.2,0.4c0,0.1,0.1,0.2,0.2,0.3 C39.3,8,39.5,8,39.8,8h0.8c0.6,0,1,0.1,1.3,0.3s0.4,0.5,0.4,0.9c0,0.5-0.2,0.9-0.7,1.2S40.6,10.9,39.8,10.9z M40,10.1 c0.4,0,0.6-0.1,0.9-0.2c0.2-0.1,0.3-0.3,0.3-0.5c0-0.2-0.1-0.3-0.2-0.3C40.9,9,40.7,9,40.4,9h-0.6c-0.3,0-0.5,0-0.6-0.1 c0,0,0,0,0,0c0,0,0,0-0.1,0c-0.2,0.2-0.3,0.3-0.3,0.5c0,0.2,0.1,0.4,0.3,0.5C39.4,10.1,39.6,10.1,40,10.1z M39.3,6.3 c0.1,0.2,0.3,0.2,0.5,0.2s0.4-0.1,0.5-0.2s0.2-0.4,0.2-0.6c0-0.3-0.1-0.5-0.2-0.6c-0.1-0.2-0.3-0.2-0.5-0.2S39.5,4.9,39.3,5 c-0.1,0.2-0.2,0.4-0.2,0.6C39.1,5.9,39.2,6.2,39.3,6.3z" class="jsx-2665686021 st1"></path><path d="M45.2,10.3c-0.1,0-0.2,0-0.2-0.1c-0.1-0.1-0.1-0.1-0.1-0.2V9.9c0-0.1,0-0.2,0.1-0.2c0.1-0.1,0.1-0.1,0.2-0.1 h0.7c0,0,0,0,0,0V2.7c0,0,0,0,0,0h-0.7c-0.1,0-0.2,0-0.2-0.1c-0.1-0.1-0.1-0.1-0.1-0.2V2.2c0-0.1,0-0.1,0.1-0.2 c0.1-0.1,0.1-0.1,0.2-0.1h1.4c0.1,0,0.2,0,0.2,0.1s0.1,0.1,0.1,0.2V10c0,0.1,0,0.2-0.1,0.2c-0.1,0.1-0.1,0.1-0.2,0.1H45.2z" class="jsx-2665686021 st0"></path></g></svg></div><div class="header__NavArea-sc-167w593-6 fPWeAR"><div><div class="header__InputContainer-sc-167w593-5 iJVFAx"><input type="radio" id="Button-1" name="headerLink" class="header__Input-sc-167w593-4 kSlqff" checked=""/><label id="Label-1" for="Button-1" class="header__Button-sc-167w593-7 kVGJCk">WORK</label><input type="radio" id="Button-2" name="headerLink" class="header__Input-sc-167w593-4 kSlqff" checked=""/><label id="Label-2" for="Button-2" class="header__Button-sc-167w593-7 kVGJCk">NOTE</label><input type="radio" id="Button-3" name="headerLink" class="header__Input-sc-167w593-4 kSlqff"/><label id="Label-3" for="Button-3" class="header__Button-sc-167w593-7 kVGJCk">LINK</label><span id="Background-color" class="header__BgColorBlock-sc-167w593-3 dhiCJn"><div class="header__Icon-sc-167w593-1 jGtERv">L</div></span></div></div></div></div></div><div><div class="id__ContentContainer-sc-2nrngo-0 kxBtcF"><div><h1 id="å¯¦ä½œç´€éŒ„-ä½¿ç”¨-github-action-cicd-hackmd-å»ºç«‹å³æ™‚æ›´æ–°çš„å€‹äºº-blog">[å¯¦ä½œç´€éŒ„] ä½¿ç”¨ Github Action (CI/CD), Hackmd å»ºç«‹å³æ™‚æ›´æ–°çš„å€‹äºº blog</h1>
<h6 id="nextdynamic-routegithub-actionhackmdå¯¦ä½œç­†è¨˜">Next,Dynamic Route,Github Action,Hackmd,å¯¦ä½œç­†è¨˜</h6>
<p><strong>HackMD æ˜¯æˆ‘ç¿’æ…£çš„ç­†è¨˜å·¥å…·ï¼Œåœ¨ code å€‹äººéƒ¨è½æ ¼çš„æ™‚å€™ï¼Œç‚ºäº†å¯¦ç¾åšå®Œç­†è¨˜ï¼Œä¸€æŒ‰ä¸‹ publishï¼Œå€‹äººéƒ¨è½æ ¼ç«‹åˆ»ç”¢ç”Ÿä¸€ç¯‡æ–‡ç« ï¼Œä¹Ÿä¸ç”¨å»æ¬é·æ–‡ç« æˆ–é©æ‡‰æ–°çš„ CMS å¾Œå°...çš„æ‡¶äººé­”æ³• (ã‚âˆ€ï½¥)ï¼Œæˆ‘é¸æ“‡ç”¨ HackMD çš„ Github æ¨æ‹‰åŠŸèƒ½ï¼Œå¯¦ç¾å…§å®¹çš„å³æ™‚æ›´æ–°ï¼Œè€Œä¸”æ¨æ‹‰åŠŸèƒ½é‚„æœ‰åƒ PR ä¸€æ¨£çš„ change highlight ï¼Œååˆ†è¦ªåˆ‡</strong>ã€‚</p>
<p>ç•¥é Create Next Appã€Next Dynamic Route ç­‰ç­‰æœ‰è©³ç´°å®˜æ–¹æ•™å­¸çš„éƒ¨åˆ†ï¼Œé€™ä»½ç­†è¨˜æœƒç´€éŒ„â€”â€”</p>
<ol>
<li>Github Action (CI/CD) with gh-pages(<a href="https://www.youtube.com/watch?v=yRz8D_oJMWQ">åƒè€ƒå½±ç‰‡</a>)</li>
<li>Connect to Hackmd</li>
<li>å°‡ .md æ•´ç†æˆç†æƒ³çš„è³‡æ–™æ ¼å¼</li>
<li>ä¾·é™æ€§</li>
</ol>
<hr>
<h2 id="å¯¦ä½œçš„éƒ¨åˆ†">å¯¦ä½œçš„éƒ¨åˆ†</h2>
<p>å¤§è‡´ä»‹ç´¹ä¸€ä¸‹ï¼Œé€™äº›å·¥å…·æ˜¯å¦‚ä½•åˆä½œçš„ï¼š</p>
<ol>
<li>Hackmd push md æª”æ¡ˆåˆ° Github (main branch)</li>
<li>main æ”¶åˆ°å…§å®¹ä¿®æ”¹ä¹‹å¾Œï¼Œå•Ÿå‹• Github Action æµç¨‹</li>
<li>CICD æµç¨‹è§¸ç™¼ generate md to JSON file çš„åŠŸèƒ½</li>
<li>Next SSR éšæ®µï¼ŒgetStaticProps æœƒå»å­˜å– JSON filesï¼Œè®Šæˆ note é é¢åº•ä¸‹çš„ dynamic route ä»¥åŠç›¸æ‡‰çš„é é¢å…§å®¹ e.g. /note/how-to-use-git</li>
</ol>
<h3 id="hackmd-push-md-æª”æ¡ˆåˆ°-github">Hackmd push md æª”æ¡ˆåˆ° Github</h3>
<p>åªè¦é¸æ“‡å³ä¸Šè§’çš„ä¸‰å€‹é»é»ï¼Œå°±å¯ä»¥çœ‹åˆ°ã€Œç‰ˆæœ¬èˆ‡ GitHub åŒæ­¥ã€çš„é¸é …ï¼Œè·Ÿ GitHub ç‰ˆæ§ä¸€æ¨£æœƒæœ‰æ¨é€è¨Šæ¯çš„æ¬„ä½å¯ä»¥å¡«å¯«ã€‚</p>
<h3 id="å•Ÿå‹•-github-action-æµç¨‹">å•Ÿå‹• Github Action æµç¨‹</h3>
<p>æ–°å¢ä¸€ä»½ CI è¨­å®šæª”æ¡ˆåœ¨ repo workflows è³‡æ–™å¤¾å…§</p>
<p><img src="https://i.imgur.com/oukSBTX.png" alt=""></p>
<p>æª”æ¡ˆå…§å®¹æˆ‘æ˜¯é€™æ¨£å¯«çš„ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯æ—¢æœ‰æ¨¡æ¿ï¼š</p>
<ul>
<li><p> push: branches[ main ] â€”â€”æ¨é€åˆ° main çš„æ™‚å€™ï¼Œå°±è¦åŸ·è¡Œé€™ä»½ CI</p>
</li>
<li><p> jobs: build: steps: run: npm run build:blogfile â€”â€”æˆ‘åœ¨æ—¢æœ‰æ¨¡æ¿è£¡ï¼Œæ–°å¢äº† generate md to JSON file çš„æµç¨‹ï¼Œç¢ºä¿æª”æ¡ˆè™•ç†å¥½ä¹‹å¾Œï¼Œæ‰æœƒåŸ·è¡Œ npm run build çš„éƒ¨åˆ†ã€‚</p>
</li>
<li><p>with: branch: gh-pages â€”â€”è·‘å®Œä¹‹å¾Œï¼Œæˆ‘çš„é é¢ deploy åˆ° gh-pages</p>
<pre><code class="language-yml=">name: Node.js CI
on:
push:
  branches: [ main ]
pull_request:
  branches: [ main ]
jobs:
build:
  runs-on: ubuntu-latest

  strategy:
    matrix:
      node-version: [14.x, 15.x]
  steps:
  - uses: actions/checkout@v2
  - name: Use Node.js ${{ matrix.node-version }}
    uses: actions/setup-node@v2
    with:
      node-version: ${{ matrix.node-version }}
  - run: npm ci
  - run: npm i
  - run: npm run build:blogfile
  - run: npm run build
  - run: npm run export
  - run: touch ./out/.nojekyll
  - name: Deploy ğŸš€
    uses: JamesIves/github-pages-deploy-action@4.1.1
    with:
        branch: gh-pages # The branch the action should deploy to.
        folder: out # The folder the action should deploy.
</code></pre>
</li>
</ul>
<p>æ¨é€åˆ° main ä¹‹å¾Œï¼Œæœƒçœ‹åˆ° Github çš„é€™å€‹ä½ç½®æœ‰çš„é»ƒè‰²é»é»ï¼ˆä»£è¡¨ CI æ­£åœ¨é‹è¡Œä¸­ï¼‰å¦‚æœæ˜¯ç¶ è‰²å‹¾å‹¾ï¼Œå°±ä»£è¡¨é‹è¡ŒæˆåŠŸã€‚é»æ“Šé¡è‰²é»é»ï¼Œå¯ä»¥è¿‘ä¸€æ­¥æŸ¥çœ‹ detailã€‚</p>
<p><img src="https://i.imgur.com/xp6WXEi.png" alt=""></p>
<h3 id="generate-md-to-json-file">generate md to JSON file</h3>
<p>ç‚ºäº†æŠŠ .md è®Šæˆå¯ä»¥é‹ç”¨çš„æª”æ¡ˆï¼Œæˆ‘ä½¿ç”¨çš„å¥—ä»¶æ˜¯ <a href="https://marked.js.org/">Marked</a>ã€‚ä»–å¯ä»¥æŠŠ markdown è®Šæˆ html objectï¼Œç„¶å¾Œå†ä½¿ç”¨ React çš„ dangerouslySetInnerHTML æŠŠå…§å®¹é€é€² DOM tree å°±å¯ä»¥é¡¯ç¤ºåœ¨ç•«é¢ä¸Šæ‘Ÿã€‚</p>
<pre><code class="language-javascript=">const getPost = () =&gt; {
  const PostConfig = []
  //å…ˆé¸å®š md æ–‡ç« çš„è³‡æ–™å¤¾
  const postsDirectory = path.join(process.cwd(), &#39;/pages/note/postContent&#39;)
  //å†é€²å…¥è³‡æ–™å¤¾ï¼Œå–å¾—æ–‡ç« çš„æª”æ¡ˆåç¨±ï¼Œç•¶æˆ id
  const fileNames = fs.readdirSync(postsDirectory)
  fileNames.map((fileName, index) =&gt; {
    const id = fileName.replace(/\.md$/, &#39;&#39;)
    //çµ„æˆä¸‹è¼‰æª”æ¡ˆçš„å®Œæ•´è·¯å¾‘
    const fullPath = path.join(postsDirectory, fileName)
    //ä¸‹è¼‰æª”æ¡ˆ
    const fileContents = fs.readFileSync(fullPath, &#39;utf8&#39;)
    //ä½¿ç”¨å¥—ä»¶ä¿®æ”¹æª”æ¡ˆæ ¼å¼
    const htmlResult = marked(fileContents);
    PostConfig.push({
      [id]: {
        htmlResult,
      }
    })
  })
  //å¯«å…¥ JSON æª”æ¡ˆï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘é‚„ç›´æ¥æŠŠæª”æ¡ˆå›å‚³çµ¦ Next çš„ getStaticProps
  fs.writeFile(&quot;pages/note/data.json&quot;, JSON.stringify(clientSidePostConfig), function (err, result) {
    if (err) console.log(&#39;error&#39;, err);
  })
}
</code></pre>
<h3 id="ä¾·é™æ€§">ä¾·é™æ€§</h3>
<p>gh-pages è² è²¬ static contentï¼Œæª”æ¡ˆå¿…éœ€è¦å…ˆè¢« compileï¼Œå¦‚æœæˆ‘æƒ³è¦ä½¿ç”¨ Next.js å¯« APIï¼Œå°±æœƒç™¼ç¾ Next API ä¸æ”¯æ´ exportã€‚å¿…é ˆè¦æ­é…å…¶ä»–æ–¹æ³•ï¼Œä¾‹å¦‚æˆ‘æ‹†æ‰é‡ç·´ç›´æ¥ä½¿ç”¨ Vercel deployï¼Œæˆ–è€…ä½¿ç”¨ AWS Lambda çš„æœå‹™ã€‚ï¼ˆ<a href="https://medium.com/@raphaelvigee/serverless-hosting-with-github-pages-aws-lambda-3c19e55d2cc4">AWS Lamda + gh-pages</a> çš„æ•™å­¸æ–‡ç« ï¼Œpin èµ·ä¾†ä¹‹å¾Œå¯èƒ½æœƒå¯¦ä½œçœ‹çœ‹ï¼‰</p>
<p>åœ¨é€™å€‹å°ˆæ¡ˆçš„éç¨‹ä¸­ï¼Œå‰›å¥½æœ‰æ©Ÿæœƒç¢°åˆ°äº†ä¸€äº› severless çš„è³‡è¨Šï¼Œäººå®¶èªªå¯¦éš›å‹•æ‰‹ä½œèƒ½å¤ å­¸ç¿’æ›´å¤šæ‰€è¨€ä¸å‡ã€‚</p>
</div><h5><a href="/">HOME PAGE</a></h5></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"static-blog-with-next-and-hackmd","title":"static-blog-with-next-and-hackmd","content":{"title":"[å¯¦ä½œç´€éŒ„] ä½¿ç”¨ Github Action (CI/CD), Hackmd å»ºç«‹å³æ™‚æ›´æ–°çš„å€‹äºº blog","tag":"Next,Dynamic Route,Github Action,Hackmd,å¯¦ä½œç­†è¨˜","htmlResult":"\u003ch1 id=\"å¯¦ä½œç´€éŒ„-ä½¿ç”¨-github-action-cicd-hackmd-å»ºç«‹å³æ™‚æ›´æ–°çš„å€‹äºº-blog\"\u003e[å¯¦ä½œç´€éŒ„] ä½¿ç”¨ Github Action (CI/CD), Hackmd å»ºç«‹å³æ™‚æ›´æ–°çš„å€‹äºº blog\u003c/h1\u003e\n\u003ch6 id=\"nextdynamic-routegithub-actionhackmdå¯¦ä½œç­†è¨˜\"\u003eNext,Dynamic Route,Github Action,Hackmd,å¯¦ä½œç­†è¨˜\u003c/h6\u003e\n\u003cp\u003e\u003cstrong\u003eHackMD æ˜¯æˆ‘ç¿’æ…£çš„ç­†è¨˜å·¥å…·ï¼Œåœ¨ code å€‹äººéƒ¨è½æ ¼çš„æ™‚å€™ï¼Œç‚ºäº†å¯¦ç¾åšå®Œç­†è¨˜ï¼Œä¸€æŒ‰ä¸‹ publishï¼Œå€‹äººéƒ¨è½æ ¼ç«‹åˆ»ç”¢ç”Ÿä¸€ç¯‡æ–‡ç« ï¼Œä¹Ÿä¸ç”¨å»æ¬é·æ–‡ç« æˆ–é©æ‡‰æ–°çš„ CMS å¾Œå°...çš„æ‡¶äººé­”æ³• (ã‚âˆ€ï½¥)ï¼Œæˆ‘é¸æ“‡ç”¨ HackMD çš„ Github æ¨æ‹‰åŠŸèƒ½ï¼Œå¯¦ç¾å…§å®¹çš„å³æ™‚æ›´æ–°ï¼Œè€Œä¸”æ¨æ‹‰åŠŸèƒ½é‚„æœ‰åƒ PR ä¸€æ¨£çš„ change highlight ï¼Œååˆ†è¦ªåˆ‡\u003c/strong\u003eã€‚\u003c/p\u003e\n\u003cp\u003eç•¥é Create Next Appã€Next Dynamic Route ç­‰ç­‰æœ‰è©³ç´°å®˜æ–¹æ•™å­¸çš„éƒ¨åˆ†ï¼Œé€™ä»½ç­†è¨˜æœƒç´€éŒ„â€”â€”\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGithub Action (CI/CD) with gh-pages(\u003ca href=\"https://www.youtube.com/watch?v=yRz8D_oJMWQ\"\u003eåƒè€ƒå½±ç‰‡\u003c/a\u003e)\u003c/li\u003e\n\u003cli\u003eConnect to Hackmd\u003c/li\u003e\n\u003cli\u003eå°‡ .md æ•´ç†æˆç†æƒ³çš„è³‡æ–™æ ¼å¼\u003c/li\u003e\n\u003cli\u003eä¾·é™æ€§\u003c/li\u003e\n\u003c/ol\u003e\n\u003chr\u003e\n\u003ch2 id=\"å¯¦ä½œçš„éƒ¨åˆ†\"\u003eå¯¦ä½œçš„éƒ¨åˆ†\u003c/h2\u003e\n\u003cp\u003eå¤§è‡´ä»‹ç´¹ä¸€ä¸‹ï¼Œé€™äº›å·¥å…·æ˜¯å¦‚ä½•åˆä½œçš„ï¼š\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eHackmd push md æª”æ¡ˆåˆ° Github (main branch)\u003c/li\u003e\n\u003cli\u003emain æ”¶åˆ°å…§å®¹ä¿®æ”¹ä¹‹å¾Œï¼Œå•Ÿå‹• Github Action æµç¨‹\u003c/li\u003e\n\u003cli\u003eCICD æµç¨‹è§¸ç™¼ generate md to JSON file çš„åŠŸèƒ½\u003c/li\u003e\n\u003cli\u003eNext SSR éšæ®µï¼ŒgetStaticProps æœƒå»å­˜å– JSON filesï¼Œè®Šæˆ note é é¢åº•ä¸‹çš„ dynamic route ä»¥åŠç›¸æ‡‰çš„é é¢å…§å®¹ e.g. /note/how-to-use-git\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"hackmd-push-md-æª”æ¡ˆåˆ°-github\"\u003eHackmd push md æª”æ¡ˆåˆ° Github\u003c/h3\u003e\n\u003cp\u003eåªè¦é¸æ“‡å³ä¸Šè§’çš„ä¸‰å€‹é»é»ï¼Œå°±å¯ä»¥çœ‹åˆ°ã€Œç‰ˆæœ¬èˆ‡ GitHub åŒæ­¥ã€çš„é¸é …ï¼Œè·Ÿ GitHub ç‰ˆæ§ä¸€æ¨£æœƒæœ‰æ¨é€è¨Šæ¯çš„æ¬„ä½å¯ä»¥å¡«å¯«ã€‚\u003c/p\u003e\n\u003ch3 id=\"å•Ÿå‹•-github-action-æµç¨‹\"\u003eå•Ÿå‹• Github Action æµç¨‹\u003c/h3\u003e\n\u003cp\u003eæ–°å¢ä¸€ä»½ CI è¨­å®šæª”æ¡ˆåœ¨ repo workflows è³‡æ–™å¤¾å…§\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://i.imgur.com/oukSBTX.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eæª”æ¡ˆå…§å®¹æˆ‘æ˜¯é€™æ¨£å¯«çš„ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯æ—¢æœ‰æ¨¡æ¿ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003e push: branches[ main ] â€”â€”æ¨é€åˆ° main çš„æ™‚å€™ï¼Œå°±è¦åŸ·è¡Œé€™ä»½ CI\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e jobs: build: steps: run: npm run build:blogfile â€”â€”æˆ‘åœ¨æ—¢æœ‰æ¨¡æ¿è£¡ï¼Œæ–°å¢äº† generate md to JSON file çš„æµç¨‹ï¼Œç¢ºä¿æª”æ¡ˆè™•ç†å¥½ä¹‹å¾Œï¼Œæ‰æœƒåŸ·è¡Œ npm run build çš„éƒ¨åˆ†ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003ewith: branch: gh-pages â€”â€”è·‘å®Œä¹‹å¾Œï¼Œæˆ‘çš„é é¢ deploy åˆ° gh-pages\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-yml=\"\u003ename: Node.js CI\non:\npush:\n  branches: [ main ]\npull_request:\n  branches: [ main ]\njobs:\nbuild:\n  runs-on: ubuntu-latest\n\n  strategy:\n    matrix:\n      node-version: [14.x, 15.x]\n  steps:\n  - uses: actions/checkout@v2\n  - name: Use Node.js ${{ matrix.node-version }}\n    uses: actions/setup-node@v2\n    with:\n      node-version: ${{ matrix.node-version }}\n  - run: npm ci\n  - run: npm i\n  - run: npm run build:blogfile\n  - run: npm run build\n  - run: npm run export\n  - run: touch ./out/.nojekyll\n  - name: Deploy ğŸš€\n    uses: JamesIves/github-pages-deploy-action@4.1.1\n    with:\n        branch: gh-pages # The branch the action should deploy to.\n        folder: out # The folder the action should deploy.\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eæ¨é€åˆ° main ä¹‹å¾Œï¼Œæœƒçœ‹åˆ° Github çš„é€™å€‹ä½ç½®æœ‰çš„é»ƒè‰²é»é»ï¼ˆä»£è¡¨ CI æ­£åœ¨é‹è¡Œä¸­ï¼‰å¦‚æœæ˜¯ç¶ è‰²å‹¾å‹¾ï¼Œå°±ä»£è¡¨é‹è¡ŒæˆåŠŸã€‚é»æ“Šé¡è‰²é»é»ï¼Œå¯ä»¥è¿‘ä¸€æ­¥æŸ¥çœ‹ detailã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://i.imgur.com/xp6WXEi.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch3 id=\"generate-md-to-json-file\"\u003egenerate md to JSON file\u003c/h3\u003e\n\u003cp\u003eç‚ºäº†æŠŠ .md è®Šæˆå¯ä»¥é‹ç”¨çš„æª”æ¡ˆï¼Œæˆ‘ä½¿ç”¨çš„å¥—ä»¶æ˜¯ \u003ca href=\"https://marked.js.org/\"\u003eMarked\u003c/a\u003eã€‚ä»–å¯ä»¥æŠŠ markdown è®Šæˆ html objectï¼Œç„¶å¾Œå†ä½¿ç”¨ React çš„ dangerouslySetInnerHTML æŠŠå…§å®¹é€é€² DOM tree å°±å¯ä»¥é¡¯ç¤ºåœ¨ç•«é¢ä¸Šæ‘Ÿã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript=\"\u003econst getPost = () =\u0026gt; {\n  const PostConfig = []\n  //å…ˆé¸å®š md æ–‡ç« çš„è³‡æ–™å¤¾\n  const postsDirectory = path.join(process.cwd(), \u0026#39;/pages/note/postContent\u0026#39;)\n  //å†é€²å…¥è³‡æ–™å¤¾ï¼Œå–å¾—æ–‡ç« çš„æª”æ¡ˆåç¨±ï¼Œç•¶æˆ id\n  const fileNames = fs.readdirSync(postsDirectory)\n  fileNames.map((fileName, index) =\u0026gt; {\n    const id = fileName.replace(/\\.md$/, \u0026#39;\u0026#39;)\n    //çµ„æˆä¸‹è¼‰æª”æ¡ˆçš„å®Œæ•´è·¯å¾‘\n    const fullPath = path.join(postsDirectory, fileName)\n    //ä¸‹è¼‰æª”æ¡ˆ\n    const fileContents = fs.readFileSync(fullPath, \u0026#39;utf8\u0026#39;)\n    //ä½¿ç”¨å¥—ä»¶ä¿®æ”¹æª”æ¡ˆæ ¼å¼\n    const htmlResult = marked(fileContents);\n    PostConfig.push({\n      [id]: {\n        htmlResult,\n      }\n    })\n  })\n  //å¯«å…¥ JSON æª”æ¡ˆï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘é‚„ç›´æ¥æŠŠæª”æ¡ˆå›å‚³çµ¦ Next çš„ getStaticProps\n  fs.writeFile(\u0026quot;pages/note/data.json\u0026quot;, JSON.stringify(clientSidePostConfig), function (err, result) {\n    if (err) console.log(\u0026#39;error\u0026#39;, err);\n  })\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"ä¾·é™æ€§\"\u003eä¾·é™æ€§\u003c/h3\u003e\n\u003cp\u003egh-pages è² è²¬ static contentï¼Œæª”æ¡ˆå¿…éœ€è¦å…ˆè¢« compileï¼Œå¦‚æœæˆ‘æƒ³è¦ä½¿ç”¨ Next.js å¯« APIï¼Œå°±æœƒç™¼ç¾ Next API ä¸æ”¯æ´ exportã€‚å¿…é ˆè¦æ­é…å…¶ä»–æ–¹æ³•ï¼Œä¾‹å¦‚æˆ‘æ‹†æ‰é‡ç·´ç›´æ¥ä½¿ç”¨ Vercel deployï¼Œæˆ–è€…ä½¿ç”¨ AWS Lambda çš„æœå‹™ã€‚ï¼ˆ\u003ca href=\"https://medium.com/@raphaelvigee/serverless-hosting-with-github-pages-aws-lambda-3c19e55d2cc4\"\u003eAWS Lamda + gh-pages\u003c/a\u003e çš„æ•™å­¸æ–‡ç« ï¼Œpin èµ·ä¾†ä¹‹å¾Œå¯èƒ½æœƒå¯¦ä½œçœ‹çœ‹ï¼‰\u003c/p\u003e\n\u003cp\u003eåœ¨é€™å€‹å°ˆæ¡ˆçš„éç¨‹ä¸­ï¼Œå‰›å¥½æœ‰æ©Ÿæœƒç¢°åˆ°äº†ä¸€äº› severless çš„è³‡è¨Šï¼Œäººå®¶èªªå¯¦éš›å‹•æ‰‹ä½œèƒ½å¤ å­¸ç¿’æ›´å¤šæ‰€è¨€ä¸å‡ã€‚\u003c/p\u003e\n"}}},"__N_SSG":true},"page":"/note/[id]","query":{"id":"static-blog-with-next-and-hackmd"},"buildId":"GgYYsDgSRzKfA8YqvQruY","isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-ff94e68042added27a93.js"></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/framework.4b1beca48388539e3889.js" async=""></script><script src="/_next/static/chunks/7751f052908bdf88c510ca6de06c69a2e694bfcc.f5a7ca967e991739ef1f.js" async=""></script><script src="/_next/static/chunks/main-b56ab24403fe3799fc3d.js" async=""></script><script src="/_next/static/chunks/e52c9149a6a64a5c94b81cf3acc4d0fb13eb3001.fa77069985ac71631d77.js" async=""></script><script src="/_next/static/chunks/pages/_app-9a36d99722b7751d4fff.js" async=""></script><script src="/_next/static/chunks/pages/note/%5Bid%5D-d4f1f3ec65736fd998ff.js" async=""></script><script src="/_next/static/GgYYsDgSRzKfA8YqvQruY/_buildManifest.js" async=""></script><script src="/_next/static/GgYYsDgSRzKfA8YqvQruY/_ssgManifest.js" async=""></script></body></html>